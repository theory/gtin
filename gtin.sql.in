--
--	PostgreSQL code for GTINs.
--

-- Adjust this setting to control where the objects get created.
SET search_path = public;
SET client_min_messages = warning;

--
-- Validation functions for potential GTINs.
--

/*
CREATE OR REPLACE FUNCTION isa_gtin (bigint)
RETURNS boolean
AS 'MODULE_PATHNAME','isa_gtin_int64'
LANGUAGE 'C' STRICT;
*/

CREATE OR REPLACE FUNCTION isa_gtin (text)
RETURNS boolean
AS 'MODULE_PATHNAME','isa_gtin_text'
LANGUAGE 'C' IMMUTABLE STRICT;

--
--	Input function and the type itself.
--

CREATE FUNCTION gtin_in(cstring)
RETURNS gtin
AS 'MODULE_PATHNAME'
LANGUAGE C IMMUTABLE STRICT;

CREATE FUNCTION gtin_out(gtin)
RETURNS cstring
AS 'MODULE_PATHNAME'
LANGUAGE C IMMUTABLE STRICT;

CREATE TYPE gtin (
	INTERNALLENGTH = 19,
	INPUT          = gtin_in,
	OUTPUT         = gtin_out
);

COMMENT ON TYPE gtin IS 'Global Trade Item Number';

--
-- Conversion to and from TEXT.
--

CREATE FUNCTION TEXT(gtin)
RETURNS text
AS 'MODULE_PATHNAME', 'gtin_to_text'
LANGUAGE C IMMUTABLE STRICT;

CREATE CAST( GTIN AS TEXT ) WITH FUNCTION TEXT( GTIN ) AS IMPLICIT;

CREATE FUNCTION GTIN(text)
RETURNS gtin
AS 'MODULE_PATHNAME', 'text_to_gtin'
LANGUAGE C IMMUTABLE STRICT;

CREATE CAST( TEXT AS GTIN ) WITH FUNCTION GTIN( TEXT ) AS IMPLICIT;
